---
interface Props {
  lang?: 'sv' | 'en';
  title: string;
  excerpt: string;
  role: string;
  stack: string[];
  tags: string[];
  outcomes: string[];
  liveUrl?: string;
  repoUrl?: string;
  caseImage?: string;
  backHref: string;
  backLabel: string;
  contactHref: string;
  contactLabel: string;
  ctaTitle: string;
  ctaText: string;
}

const {
  lang = 'sv',
  title,
  excerpt,
  role,
  stack,
  tags,
  outcomes,
  liveUrl,
  repoUrl,
  caseImage,
  backHref,
  backLabel,
  contactHref,
  contactLabel,
  ctaTitle,
  ctaText,
} = Astro.props;

const labels =
  lang === 'en'
    ? {
        role: 'Role',
        stack: 'Stack',
        tags: 'Tags',
        outcomes: 'Outcomes',
        preview: 'Case Preview',
        previewHint: 'Add `caseImage` in project frontmatter to show a real screenshot.',
        visit: 'Visit live site',
        source: 'View source',
        contextTitle: 'Project context',
        contextP1: `In this project I worked as ${role.toLowerCase()} and focused on turning requirements into a stable, production-ready solution.`,
        contextP2: `The delivery combined ${stack.join(', ')} with focus areas such as ${tags.join(', ').toLowerCase()} to create a solution that is both maintainable and scalable over time.`,
        approachTitle: 'Implementation approach',
        approachText:
          'The work followed a practical flow: define structure, implement core functionality, automate repetitive steps, and continuously validate quality before release.',
      }
    : {
        role: 'Roll',
        stack: 'Stack',
        tags: 'Taggar',
        outcomes: 'Resultat',
        preview: 'Case Preview',
        previewHint: 'Lägg till `caseImage` i projektets frontmatter för att visa riktig skärmbild.',
        visit: 'Besök live-sajt',
        source: 'Visa källkod',
        contextTitle: 'Projektkontext',
        contextP1: `I det här projektet arbetade jag som ${role.toLowerCase()} med fokus på att omsätta krav till en stabil, produktionsklar lösning.`,
        contextP2: `Leveransen kombinerade ${stack.join(', ')} med fokusområden som ${tags.join(', ').toLowerCase()} för att skapa en lösning som är både hållbar och skalbar över tid.`,
        approachTitle: 'Arbetssätt i implementationen',
        approachText:
          'Arbetet följde ett praktiskt flöde: definiera struktur, bygga kärnfunktionalitet, automatisera repetitiva moment och kvalitetssäkra kontinuerligt inför release.',
      };

const fallbackImage = caseImage
  ? caseImage.endsWith('.jpg')
    ? caseImage.replace(/\.jpg$/, '.png')
    : caseImage.endsWith('.jpeg')
      ? caseImage.replace(/\.jpeg$/, '.png')
      : caseImage.endsWith('.png')
        ? caseImage.replace(/\.png$/, '.jpg')
        : undefined
  : undefined;
---

<article class="space-y-8" aria-labelledby="project-title">
  <section class="band band--mesh">
    <div class="mx-auto max-w-6xl">
      <a href={backHref} class="inline-flex text-sm font-semibold text-cyan-300 transition hover:text-cyan-200">{backLabel}</a>

      <div class="mt-6 grid gap-6 lg:grid-cols-12 lg:items-start">
        <div class="lg:col-span-7">
          <h1 id="project-title" class="text-3xl font-semibold tracking-tight text-white md:text-5xl">{title}</h1>
          <p class="mt-4 max-w-3xl text-base leading-relaxed text-neutral-300 md:text-lg">{excerpt}</p>

          <div class="mt-6 flex flex-wrap gap-3">
            {liveUrl && (
              <a
                href={liveUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="btn-primary inline-flex items-center gap-2 px-5 py-3 text-sm"
              >
                {labels.visit}
                <span aria-hidden="true">↗</span>
              </a>
            )}
            {repoUrl && (
              <a
                href={repoUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="btn-secondary inline-flex items-center gap-2 px-5 py-3 text-sm"
              >
                {labels.source}
                <span aria-hidden="true">↗</span>
              </a>
            )}
          </div>
        </div>

        <aside class="lg:col-span-5">
          <article class="ui-card ui-card--interactive p-4 text-left">
            <p class="text-xs uppercase tracking-[0.14em] text-cyan-300">{labels.preview}</p>
            {caseImage ? (
              <img
                src={caseImage}
                alt={`${title} case preview`}
                loading="lazy"
                data-fallback={fallbackImage}
                onerror="if (this.dataset.fallbackTried === '1') return; this.dataset.fallbackTried = '1'; if (this.dataset.fallback) { this.src = this.dataset.fallback; }"
                class="mt-3 aspect-[16/10] w-full rounded-xl border border-white/10 object-cover"
              />
            ) : (
              <div class="mt-3 flex aspect-[16/10] w-full items-center justify-center rounded-xl border border-dashed border-white/20 bg-white/[0.03] p-4 text-center text-xs text-neutral-400">
                {labels.previewHint}
              </div>
            )}
          </article>
        </aside>
      </div>

      <div class="mt-8 grid grid-cols-1 gap-4 md:grid-cols-3">
        <div class="ui-card p-5">
          <p class="text-xs uppercase tracking-[0.16em] text-cyan-300">{labels.role}</p>
          <p class="mt-3 text-sm text-neutral-200">{role}</p>
        </div>
        <div class="ui-card p-5">
          <p class="text-xs uppercase tracking-[0.16em] text-cyan-300">{labels.stack}</p>
          <p class="mt-3 text-sm text-neutral-200">{stack.join(' · ')}</p>
        </div>
        <div class="ui-card p-5">
          <p class="text-xs uppercase tracking-[0.16em] text-cyan-300">{labels.tags}</p>
          <div class="mt-3 flex flex-wrap gap-2">
            {tags.map((tag) => (
              <span class="rounded-full border border-white/15 bg-white/5 px-2.5 py-1 text-xs text-neutral-200">{tag}</span>
            ))}
          </div>
        </div>
      </div>

      <section class="mt-8 grid gap-4 md:grid-cols-2" aria-labelledby="context-title">
        <article class="ui-card ui-card--interactive p-5 text-left">
          <h2 id="context-title" class="text-lg font-semibold text-white">{labels.contextTitle}</h2>
          <p class="mt-3 text-sm leading-relaxed text-neutral-300">{labels.contextP1}</p>
          <p class="mt-3 text-sm leading-relaxed text-neutral-300">{labels.contextP2}</p>
        </article>
        <article class="ui-card ui-card--interactive p-5 text-left">
          <h2 class="text-lg font-semibold text-white">{labels.approachTitle}</h2>
          <p class="mt-3 text-sm leading-relaxed text-neutral-300">{labels.approachText}</p>
        </article>
      </section>

      <section class="mt-8" aria-labelledby="outcomes-title">
        <h2 id="outcomes-title" class="text-lg font-semibold text-white">{labels.outcomes}</h2>
        <ul class="mt-4 grid grid-cols-1 gap-3 md:grid-cols-2">
          {outcomes.map((outcome) => (
            <li class="ui-card ui-card--interactive p-4 text-sm text-neutral-200">{outcome}</li>
          ))}
        </ul>
      </section>

      <section class="prose prose-invert mt-10 max-w-none rounded-2xl border border-white/10 bg-white/[0.02] p-6 md:p-8 prose-headings:text-white prose-p:text-neutral-300 prose-strong:text-white prose-a:text-cyan-300 hover:prose-a:text-cyan-200">
        <slot />
      </section>
    </div>
  </section>

  <section class="band band--surface seam-top" aria-label="Project contact call-to-action">
    <h2 class="text-2xl font-semibold tracking-tight text-white md:text-3xl">{ctaTitle}</h2>
    <p class="mt-4 max-w-2xl text-neutral-300">{ctaText}</p>
    <div class="mt-6 flex flex-wrap justify-center gap-3">
      <a href={contactHref} class="btn-primary inline-flex rounded-xl px-5 py-3 text-sm font-semibold text-neutral-950 transition">
        {contactLabel}
      </a>
      {liveUrl && (
        <a
          href={liveUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="btn-secondary inline-flex items-center gap-2 rounded-xl px-5 py-3 text-sm"
        >
          {labels.visit}
          <span aria-hidden="true">↗</span>
        </a>
      )}
    </div>
  </section>
</article>
